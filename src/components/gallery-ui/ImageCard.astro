---
import { PAPER_PALETTE } from "../tools/paper-palette";
import { isOpenLicense } from "@/lib/license-utils";
import { Eye, EyeOff } from "lucide-react";

interface Props {
    data: {
        id: string;
        conference: string;
        image: string;
        tags: string[];
        license?: string;
    };
    index: number;
}

const { data, index } = Astro.props;
const { conference, image, tags, license } = data;
const paperColor =
    PAPER_PALETTE.find((paper) => paper.name === conference)?.color ||
    "#48cae4";

// Animation delay calculation as a CSS variable
const animationDelay = `${index * 0.015}s`; // ori: 0.06

// License status
const isOpen = isOpenLicense(license);
---

<div
    class="group relative overflow-hidden rounded-2xl shadow-lg transition-all duration-300 ease-in-out opacity-0 translate-y-8 animate-fade-in-up"
    style={{ animationDelay }}
    role="article"
    aria-label={`card from ${conference}`}
>
    <a href={`${import.meta.env.BASE_URL === "/" ? "" : import.meta.env.BASE_URL}/images/${data.id}`}>
        <img
            src={image}
            alt={conference}
            class="w-full h-auto rounded-lg object-cover transition-all duration-300 ease-in-out group-hover:brightness-60"
            loading="lazy"
        />
    </a>

    {/* License Badge - Top Left */}
    <div class="absolute top-2 left-2 opacity-90">
        <span
            class:list={[
                "inline-flex items-center justify-center gap-1 rounded-sm px-1.5 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 ring-1 ring-inset ring-black/10 transition-colors shadow-sm",
                isOpen
                    ? "bg-green-100/90 text-green-800 dark:bg-green-900/80 dark:text-green-200"
                    : "bg-red-100/90 text-red-800 dark:bg-red-900/80 dark:text-red-200",
            ]}
            title={isOpen ? "Open License" : "Copyrighted / Preview Only"}
        >
            {
                isOpen ? (
                    <Eye className="w-3 h-3" />
                ) : (
                    <EyeOff className="w-3 h-3" />
                )
            }
        </span>
    </div>

    <div class="flex flex-wrap absolute top-2 right-2 opacity-90">
        <span
            class="inline-flex items-center justify-center rounded-sm px-1.5 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 text-white ring-1 ring-inset ring-black/10 transition-colors shadow-sm"
            style={{
                backgroundColor: paperColor,
            }}
        >
            {conference}
        </span>
    </div>

    <div
        class="flex flex-wrap gap-1.5 absolute bottom-2 left-2 p-2 font-medium opacity-0 group-hover:opacity-100 transition-opacity"
    >
        {
            tags.map((tag) => (
                <span class="inline-flex items-center justify-center rounded-sm px-1.5 py-0.5 text-xs w-fit whitespace-nowrap shrink-0 bg-background/90 backdrop-blur-sm text-muted-foreground ring-1 ring-inset ring-border transition-all duration-300">
                    {tag}
                </span>
            ))
        }
    </div>
</div>

<style>
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(2rem);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-fade-in-up {
        animation: fadeInUp 0.4s ease-out forwards;
    }
</style>
